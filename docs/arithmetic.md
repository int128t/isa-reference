# Арифметические инструкции x86-64

Арифметические инструкции выполняют математические операции над операндами. Они широко используются в вычислениях и обработке данных.

## ADD - Сложение

### Синтаксис
```
ADD dest, src
```

### Описание
Складывает значения источника (src) и приемника (dest), сохраняет результат в приемнике.

### Варианты
- `ADD r/m, r` - Сложение регистра с регистром/памятью
- `ADD r, r/m` - Сложение регистра/памяти с регистром
- `ADD r/m, imm` - Сложение непосредственного значения с регистром/памятью

### Примеры
```assembly
ADD RAX, RBX        ; RAX = RAX + RBX
ADD [RCX], RDX      ; [RCX] = [RCX] + RDX
ADD RAX, 42         ; RAX = RAX + 42
```

### Флаги
- `CF` - устанавливается при переносе из старшего бита
- `OF` - устанавливается при знаковом переполнении
- `SF` - устанавливается, если результат отрицательный
- `ZF` - устанавливается, если результат равен нулю
- `PF` - устанавливается, если результат содержит четное число единичных битов
- `AF` - устанавливается при переносе между 3 и 4 битами (для BCD)

## SUB - Вычитание

### Синтаксис
```
SUB dest, src
```

### Описание
Вычитает значение источника (src) из приемника (dest), сохраняет результат в приемнике.

### Варианты
- `SUB r/m, r` - Вычитание регистра из регистра/памяти
- `SUB r, r/m` - Вычитание регистра/памяти из регистра
- `SUB r/m, imm` - Вычитание непосредственного значения из регистра/памяти

### Примеры
```assembly
SUB RAX, RBX        ; RAX = RAX - RBX
SUB [RCX], RDX      ; [RCX] = [RCX] - RDX
SUB RAX, 42         ; RAX = RAX - 42
```

### Флаги
Влияет на флаги так же, как ADD.

## INC/DEC - Инкремент/Декремент

### Синтаксис
```
INC dest
DEC dest
```

### Описание
- `INC` увеличивает значение операнда на 1
- `DEC` уменьшает значение операнда на 1

### Примеры
```assembly
INC RAX             ; RAX = RAX + 1
DEC [RBX]           ; [RBX] = [RBX] - 1
```

### Флаги
Влияют на все флаги, кроме CF.

## NEG - Отрицание

### Синтаксис
```
NEG dest
```

### Описание
Меняет знак операнда (вычисляет дополнение до двух).

### Примеры
```assembly
NEG RAX             ; RAX = -RAX
NEG [RBX]           ; [RBX] = -[RBX]
```

### Флаги
- `CF` - устанавливается, если операнд не равен 0
- Остальные флаги устанавливаются как при вычитании из нуля

## MUL - Беззнаковое умножение

### Синтаксис
```
MUL src
```

### Описание
Умножает неявный операнд (AX, EAX или RAX) на источник (src). Результат сохраняется в:
- 8-битное умножение: AX = AL * src
- 16-битное умножение: DX:AX = AX * src
- 32-битное умножение: EDX:EAX = EAX * src
- 64-битное умножение: RDX:RAX = RAX * src

### Примеры
```assembly
MUL BL              ; AX = AL * BL
MUL CX              ; DX:AX = AX * CX
MUL EDX             ; EDX:EAX = EAX * EDX
MUL RCX             ; RDX:RAX = RAX * RCX
```

### Флаги
- `CF`, `OF` - устанавливаются, если старшая половина результата не равна нулю
- `SF`, `ZF`, `PF`, `AF` - не определены

## IMUL - Знаковое умножение

### Синтаксис
```
IMUL src
IMUL dest, src
IMUL dest, src, imm
```

### Описание
- Одноаргументная форма: работает как MUL, но со знаковыми числами
- Двухаргументная форма: dest = dest * src
- Трехаргументная форма: dest = src * imm

### Примеры
```assembly
IMUL BL             ; AX = AL * BL (знаковое)
IMUL RAX, RBX       ; RAX = RAX * RBX
IMUL RCX, RDX, 42   ; RCX = RDX * 42
```

### Флаги
- `CF`, `OF` - устанавливаются при переполнении
- `SF`, `ZF`, `PF`, `AF` - не определены

## DIV - Беззнаковое деление

### Синтаксис
```
DIV src
```

### Описание
Делит неявный операнд на источник (src):
- 8-битное деление: AL = AX / src, AH = AX % src
- 16-битное деление: AX = DX:AX / src, DX = DX:AX % src
- 32-битное деление: EAX = EDX:EAX / src, EDX = EDX:EAX % src
- 64-битное деление: RAX = RDX:RAX / src, RDX = RDX:RAX % src

### Примеры
```assembly
DIV BL              ; AL = AX / BL, AH = AX % BL
DIV CX              ; AX = DX:AX / CX, DX = DX:AX % CX
DIV EDX             ; EAX = EDX:EAX / EDX, EDX = EDX:EAX % EDX
DIV RCX             ; RAX = RDX:RAX / RCX, RDX = RDX:RAX % RCX
```

### Флаги
Все флаги не определены.

### Особенности
Вызывает исключение деления (#DE) при делении на ноль или если результат не помещается в регистр.

## IDIV - Знаковое деление

### Синтаксис
```
IDIV src
```

### Описание
Работает как DIV, но со знаковыми числами.

### Примеры
```assembly
IDIV BL             ; AL = AX / BL, AH = AX % BL (знаковое)
IDIV RCX            ; RAX = RDX:RAX / RCX, RDX = RDX:RAX % RCX (знаковое)
```

### Флаги
Все флаги не определены.

## ADC - Сложение с переносом

### Синтаксис
```
ADC dest, src
```

### Описание
Складывает значения источника (src), приемника (dest) и флага переноса (CF), сохраняет результат в приемнике.

### Примеры
```assembly
ADC RAX, RBX        ; RAX = RAX + RBX + CF
```

### Флаги
Влияет на флаги так же, как ADD.

### Применение
Используется для реализации многоразрядной арифметики.

## SBB - Вычитание с заимствованием

### Синтаксис
```
SBB dest, src
```

### Описание
Вычитает значение источника (src) и флага переноса (CF) из приемника (dest), сохраняет результат в приемнике.

### Примеры
```assembly
SBB RAX, RBX        ; RAX = RAX - RBX - CF
```

### Флаги
Влияет на флаги так же, как SUB.

### Применение
Используется для реализации многоразрядной арифметики.

## CMP - Сравнение

### Синтаксис
```
CMP op1, op2
```

### Описание
Вычитает второй операнд из первого, но не сохраняет результат. Используется для установки флагов для последующих условных инструкций.

### Примеры
```assembly
CMP RAX, RBX        ; Устанавливает флаги на основе RAX - RBX
CMP RAX, 42         ; Устанавливает флаги на основе RAX - 42
```

### Флаги
Влияет на флаги так же, как SUB.

## Арифметические инструкции для чисел с плавающей точкой

### Скалярные операции SSE

```assembly
ADDSS xmm1, xmm2/m32    ; Сложение одиночной точности
SUBSS xmm1, xmm2/m32    ; Вычитание одиночной точности
MULSS xmm1, xmm2/m32    ; Умножение одиночной точности
DIVSS xmm1, xmm2/m32    ; Деление одиночной точности

ADDSD xmm1, xmm2/m64    ; Сложение двойной точности
SUBSD xmm1, xmm2/m64    ; Вычитание двойной точности
MULSD xmm1, xmm2/m64    ; Умножение двойной точности
DIVSD xmm1, xmm2/m64    ; Деление двойной точности
```

### Упакованные операции SSE

```assembly
ADDPS xmm1, xmm2/m128   ; Сложение 4 чисел одиночной точности
SUBPS xmm1, xmm2/m128   ; Вычитание 4 чисел одиночной точности
MULPS xmm1, xmm2/m128   ; Умножение 4 чисел одиночной точности
DIVPS xmm1, xmm2/m128   ; Деление 4 чисел одиночной точности

ADDPD xmm1, xmm2/m128   ; Сложение 2 чисел двойной точности
SUBPD xmm1, xmm2/m128   ; Вычитание 2 чисел двойной точности
MULPD xmm1, xmm2/m128   ; Умножение 2 чисел двойной точности
DIVPD xmm1, xmm2/m128   ; Деление 2 чисел двойной точности
```

## Другие арифметические инструкции

### AAA, AAS, AAM, AAD - Коррекция для двоично-десятичной арифметики
Эти инструкции не поддерживаются в 64-битном режиме.

### DAA, DAS - Десятичная коррекция
Эти инструкции не поддерживаются в 64-битном режиме.

### CBW, CWD, CDQ, CQO - Преобразование с расширением знака
```assembly
CBW                 ; AX = sign-extend AL
CWD                 ; DX:AX = sign-extend AX
CDQ                 ; EDX:EAX = sign-extend EAX
CQO                 ; RDX:RAX = sign-extend RAX
```

## Примечания

1. При работе с большими числами (больше 64 бит) используются последовательности инструкций с ADC и SBB.

2. Для оптимизации производительности:
   - Используйте LEA для простых арифметических операций (сложение, умножение на константу)
   - Используйте INC/DEC вместо ADD/SUB для изменения на 1
   - Используйте XOR reg, reg вместо MOV reg, 0 для обнуления регистра

3. Для деления на константу часто эффективнее использовать умножение на обратное значение.

4. Инструкции MUL/IMUL и DIV/IDIV имеют высокую латентность, их следует использовать с осторожностью в критических по производительности участках кода.
# SIMD инструкции x86-64

SIMD (Single Instruction, Multiple Data) - технология, позволяющая одной инструкцией обрабатывать несколько элементов данных параллельно. В архитектуре x86-64 существует несколько поколений SIMD-расширений:

1. **MMX** - первое SIMD-расширение (64-битные регистры)
2. **SSE/SSE2/SSE3/SSSE3/SSE4** - расширения для работы с 128-битными регистрами
3. **AVX/AVX2** - расширения для работы с 256-битными регистрами
4. **AVX-512** - расширения для работы с 512-битными регистрами

## MMX инструкции

MMX использует 8 64-битных регистров MM0-MM7, которые совпадают с регистрами x87 FPU.

### Основные MMX инструкции

#### MOVQ - Перемещение 64 бит

##### Синтаксис
```
MOVQ mm, mm/m64
MOVQ mm/m64, mm
```

##### Описание
Перемещает 64 бита данных между регистрами MMX или между регистром MMX и памятью.

##### Примеры
```assembly
MOVQ MM0, [RBX]     ; Загружает 64 бита из памяти в MM0
MOVQ MM1, MM2       ; Копирует MM2 в MM1
MOVQ [RAX], MM3     ; Сохраняет MM3 в память
```

#### PADDB/PADDW/PADDD - Сложение упакованных целых

##### Синтаксис
```
PADDB mm, mm/m64    ; Сложение 8 байт
PADDW mm, mm/m64    ; Сложение 4 слов
PADDD mm, mm/m64    ; Сложение 2 двойных слов
```

##### Описание
Складывает упакованные целые числа.

##### Примеры
```assembly
PADDB MM0, MM1      ; MM0 = MM0 + MM1 (8 байт)
PADDW MM2, [RCX]    ; MM2 = MM2 + [RCX] (4 слова)
PADDD MM3, MM4      ; MM3 = MM3 + MM4 (2 двойных слова)
```

#### PSUBB/PSUBW/PSUBD - Вычитание упакованных целых

##### Синтаксис
```
PSUBB mm, mm/m64    ; Вычитание 8 байт
PSUBW mm, mm/m64    ; Вычитание 4 слов
PSUBD mm, mm/m64    ; Вычитание 2 двойных слов
```

##### Описание
Вычитает упакованные целые числа.

##### Примеры
```assembly
PSUBB MM0, MM1      ; MM0 = MM0 - MM1 (8 байт)
PSUBW MM2, [RCX]    ; MM2 = MM2 - [RCX] (4 слова)
PSUBD MM3, MM4      ; MM3 = MM3 - MM4 (2 двойных слова)
```

#### PMULLW - Умножение упакованных слов

##### Синтаксис
```
PMULLW mm, mm/m64   ; Умножение 4 слов (младшие части результатов)
```

##### Описание
Умножает упакованные слова, сохраняя младшие 16 бит каждого результата.

##### Примеры
```assembly
PMULLW MM0, MM1     ; MM0 = MM0 * MM1 (4 слова, младшие части)
```

#### PAND/POR/PXOR - Логические операции

##### Синтаксис
```
PAND mm, mm/m64     ; Побитовое И
POR mm, mm/m64      ; Побитовое ИЛИ
PXOR mm, mm/m64     ; Побитовое исключающее ИЛИ
```

##### Описание
Выполняет побитовые логические операции над 64-битными операндами.

##### Примеры
```assembly
PAND MM0, MM1       ; MM0 = MM0 & MM1
POR MM2, [RCX]      ; MM2 = MM2 | [RCX]
PXOR MM3, MM4       ; MM3 = MM3 ^ MM4
```

#### EMMS - Очистка состояния MMX

##### Синтаксис
```
EMMS
```

##### Описание
Сбрасывает состояние FPU после использования MMX инструкций, позволяя переключиться обратно на инструкции x87 FPU.

##### Примеры
```assembly
; Код с использованием MMX
EMMS                ; Очистка состояния MMX
; Код с использованием x87 FPU
```

## SSE/SSE2 инструкции

SSE и SSE2 используют 16 128-битных регистров XMM0-XMM15 (в 32-битном режиме доступны только XMM0-XMM7).

### Инструкции для упакованных целых чисел

#### MOVDQA/MOVDQU - Перемещение выровненных/невыровненных 128 бит

##### Синтаксис
```
MOVDQA xmm1, xmm2/m128    ; Перемещение выровненных 128 бит
MOVDQA xmm1/m128, xmm2    ; Перемещение выровненных 128 бит
MOVDQU xmm1, xmm2/m128    ; Перемещение невыровненных 128 бит
MOVDQU xmm1/m128, xmm2    ; Перемещение невыровненных 128 бит
```

##### Описание
Перемещает 128 бит данных между регистрами XMM или между регистром XMM и памятью.

##### Примеры
```assembly
MOVDQA XMM0, [RBX]    ; Загружает выровненные 128 бит из памяти в XMM0
MOVDQU XMM1, [RCX]    ; Загружает невыровненные 128 бит из памяти в XMM1
```

#### PADDB/PADDW/PADDD/PADDQ - Сложение упакованных целых

##### Синтаксис
```
PADDB xmm1, xmm2/m128    ; Сложение 16 байт
PADDW xmm1, xmm2/m128    ; Сложение 8 слов
PADDD xmm1, xmm2/m128    ; Сложение 4 двойных слов
PADDQ xmm1, xmm2/m128    ; Сложение 2 четверных слов
```

##### Описание
Складывает упакованные целые числа.

##### Примеры
```assembly
PADDB XMM0, XMM1      ; XMM0 = XMM0 + XMM1 (16 байт)
PADDW XMM2, [RCX]     ; XMM2 = XMM2 + [RCX] (8 слов)
```

#### PSUBB/PSUBW/PSUBD/PSUBQ - Вычитание упакованных целых

##### Синтаксис
```
PSUBB xmm1, xmm2/m128    ; Вычитание 16 байт
PSUBW xmm1, xmm2/m128    ; Вычитание 8 слов
PSUBD xmm1, xmm2/m128    ; Вычитание 4 двойных слов
PSUBQ xmm1, xmm2/m128    ; Вычитание 2 четверных слов
```

##### Описание
Вычитает упакованные целые числа.

##### Примеры
```assembly
PSUBB XMM0, XMM1      ; XMM0 = XMM0 - XMM1 (16 байт)
PSUBW XMM2, [RCX]     ; XMM2 = XMM2 - [RCX] (8 слов)
```

#### PMULLW/PMULLD - Умножение упакованных целых

##### Синтаксис
```
PMULLW xmm1, xmm2/m128    ; Умножение 8 слов (младшие части результатов)
PMULLD xmm1, xmm2/m128    ; Умножение 4 двойных слов (младшие части результатов)
```

##### Описание
Умножает упакованные целые числа, сохраняя младшие части каждого результата.

##### Примеры
```assembly
PMULLW XMM0, XMM1     ; XMM0 = XMM0 * XMM1 (8 слов, младшие части)
PMULLD XMM2, [RCX]    ; XMM2 = XMM2 * [RCX] (4 двойных слова, младшие части)
```

#### PAND/POR/PXOR - Логические операции

##### Синтаксис
```
PAND xmm1, xmm2/m128     ; Побитовое И
POR xmm1, xmm2/m128      ; Побитовое ИЛИ
PXOR xmm1, xmm2/m128     ; Побитовое исключающее ИЛИ
```

##### Описание
Выполняет побитовые логические операции над 128-битными операндами.

##### Примеры
```assembly
PAND XMM0, XMM1       ; XMM0 = XMM0 & XMM1
POR XMM2, [RCX]       ; XMM2 = XMM2 | [RCX]
PXOR XMM3, XMM4       ; XMM3 = XMM3 ^ XMM4
```

#### PSLLW/PSLLD/PSLLQ - Логический сдвиг влево

##### Синтаксис
```
PSLLW xmm1, xmm2/m128/imm8    ; Сдвиг 8 слов влево
PSLLD xmm1, xmm2/m128/imm8    ; Сдвиг 4 двойных слов влево
PSLLQ xmm1, xmm2/m128/imm8    ; Сдвиг 2 четверных слов влево
```

##### Описание
Сдвигает упакованные целые числа влево.

##### Примеры
```assembly
PSLLW XMM0, 4         ; XMM0 = XMM0 << 4 (8 слов)
PSLLD XMM1, XMM2      ; XMM1 = XMM1 << XMM2 (4 двойных слова)
```

#### PSRLW/PSRLD/PSRLQ - Логический сдвиг вправо

##### Синтаксис
```
PSRLW xmm1, xmm2/m128/imm8    ; Сдвиг 8 слов вправо
PSRLD xmm1, xmm2/m128/imm8    ; Сдвиг 4 двойных слов вправо
PSRLQ xmm1, xmm2/m128/imm8    ; Сдвиг 2 четверных слов вправо
```

##### Описание
Сдвигает упакованные целые числа вправо.

##### Примеры
```assembly
PSRLW XMM0, 4         ; XMM0 = XMM0 >> 4 (8 слов)
PSRLD XMM1, XMM2      ; XMM1 = XMM1 >> XMM2 (4 двойных слова)
```

#### PCMPEQB/PCMPEQW/PCMPEQD - Сравнение на равенство

##### Синтаксис
```
PCMPEQB xmm1, xmm2/m128    ; Сравнение 16 байт на равенство
PCMPEQW xmm1, xmm2/m128    ; Сравнение 8 слов на равенство
PCMPEQD xmm1, xmm2/m128    ; Сравнение 4 двойных слов на равенство
```

##### Описание
Сравнивает упакованные целые числа на равенство. Если элементы равны, соответствующий элемент результата заполняется единицами (0xFF, 0xFFFF или 0xFFFFFFFF), иначе - нулями.

##### Примеры
```assembly
PCMPEQB XMM0, XMM1    ; Сравнивает 16 байт в XMM0 и XMM1
```

#### PCMPGTB/PCMPGTW/PCMPGTD - Сравнение на больше

##### Синтаксис
```
PCMPGTB xmm1, xmm2/m128    ; Сравнение 16 байт на больше
PCMPGTW xmm1, xmm2/m128    ; Сравнение 8 слов на больше
PCMPGTD xmm1, xmm2/m128    ; Сравнение 4 двойных слов на больше
```

##### Описание
Сравнивает упакованные целые числа на больше. Если элемент первого операнда больше соответствующего элемента второго операнда, соответствующий элемент результата заполняется единицами, иначе - нулями.

##### Примеры
```assembly
PCMPGTW XMM0, XMM1    ; Сравнивает 8 слов в XMM0 и XMM1
```

### Инструкции для упакованных чисел с плавающей точкой

Инструкции для работы с упакованными числами с плавающей точкой описаны в разделе [Инструкции для работы с плавающей точкой](floating-point.md).

### Инструкции перестановки и смешивания

#### PSHUFB - Перестановка байт

##### Синтаксис
```
PSHUFB xmm1, xmm2/m128    ; Перестановка байт
```

##### Описание
Переставляет байты в первом операнде согласно маске во втором операнде.

##### Примеры
```assembly
PSHUFB XMM0, XMM1    ; Переставляет байты в XMM0 согласно маске в XMM1
```

#### PSHUFD - Перестановка двойных слов

##### Синтаксис
```
PSHUFD xmm1, xmm2/m128, imm8    ; Перестановка двойных слов
```

##### Описание
Переставляет двойные слова во втором операнде согласно непосредственному значению и сохраняет результат в первом операнде.

##### Примеры
```assembly
PSHUFD XMM0, XMM1, 0x1B    ; Переставляет двойные слова в XMM1 и сохраняет в XMM0
```

#### PUNPCKLBW/PUNPCKLWD/PUNPCKLDQ/PUNPCKLQDQ - Распаковка и чередование младших частей

##### Синтаксис
```
PUNPCKLBW xmm1, xmm2/m128    ; Распаковка и чередование младших байт
PUNPCKLWD xmm1, xmm2/m128    ; Распаковка и чередование младших слов
PUNPCKLDQ xmm1, xmm2/m128    ; Распаковка и чередование младших двойных слов
PUNPCKLQDQ xmm1, xmm2/m128   ; Распаковка и чередование младших четверных слов
```

##### Описание
Распаковывает и чередует младшие части операндов.

##### Примеры
```assembly
PUNPCKLBW XMM0, XMM1    ; Чередует младшие байты XMM0 и XMM1
```

#### PUNPCKHBW/PUNPCKHWD/PUNPCKHDQ/PUNPCKHQDQ - Распаковка и чередование старших частей

##### Синтаксис
```
PUNPCKHBW xmm1, xmm2/m128    ; Распаковка и чередование старших байт
PUNPCKHWD xmm1, xmm2/m128    ; Распаковка и чередование старших слов
PUNPCKHDQ xmm1, xmm2/m128    ; Распаковка и чередование старших двойных слов
PUNPCKHQDQ xmm1, xmm2/m128   ; Распаковка и чередование старших четверных слов
```

##### Описание
Распаковывает и чередует старшие части операндов.

##### Примеры
```assembly
PUNPCKHWD XMM0, XMM1    ; Чередует старшие слова XMM0 и XMM1
```

## SSE3/SSSE3/SSE4 инструкции

SSE3, SSSE3 и SSE4 добавляют новые инструкции к набору SSE/SSE2.

### Некоторые важные инструкции SSE3

#### HADDPS/HADDPD - Горизонтальное сложение

##### Синтаксис
```
HADDPS xmm1, xmm2/m128    ; Горизонтальное сложение упакованных чисел с плавающей точкой одиночной точности
HADDPD xmm1, xmm2/m128    ; Горизонтальное сложение упакованных чисел с плавающей точкой двойной точности
```

##### Описание
Складывает соседние пары элементов в каждом операнде и сохраняет результаты.

##### Примеры
```assembly
HADDPS XMM0, XMM1    ; Горизонтальное сложение в XMM0 и XMM1
```

### Некоторые важные инструкции SSSE3

#### PSHUFB - Перестановка байт

##### Синтаксис
```
PSHUFB xmm1, xmm2/m128    ; Перестановка байт
```

##### Описание
Переставляет байты в первом операнде согласно маске во втором операнде.

##### Примеры
```assembly
PSHUFB XMM0, XMM1    ; Переставляет байты в XMM0 согласно маске в XMM1
```

#### PHADDW/PHADDD - Горизонтальное сложение упакованных целых

##### Синтаксис
```
PHADDW xmm1, xmm2/m128    ; Горизонтальное сложение упакованных слов
PHADDD xmm1, xmm2/m128    ; Горизонтальное сложение упакованных двойных слов
```

##### Описание
Складывает соседние пары элементов в каждом операнде и сохраняет результаты.

##### Примеры
```assembly
PHADDW XMM0, XMM1    ; Горизонтальное сложение слов в XMM0 и XMM1
```

### Некоторые важные инструкции SSE4.1

#### PBLENDVB/BLENDVPS/BLENDVPD - Смешивание с переменной маской

##### Синтаксис
```
PBLENDVB xmm1, xmm2/m128, <XMM0>    ; Смешивание байт с маской в XMM0
BLENDVPS xmm1, xmm2/m128, <XMM0>    ; Смешивание чисел с плавающей точкой одиночной точности с маской в XMM0
BLENDVPD xmm1, xmm2/m128, <XMM0>    ; Смешивание чисел с плавающей точкой двойной точности с маской в XMM0
```

##### Описание
Смешивает элементы из двух операндов согласно маске в XMM0.

##### Примеры
```assembly
PBLENDVB XMM1, XMM2, <XMM0>    ; Смешивает байты из XMM1 и XMM2 согласно маске в XMM0
```

#### PTEST - Проверка битов

##### Синтаксис
```
PTEST xmm1, xmm2/m128    ; Проверка битов
```

##### Описание
Выполняет побитовое AND между первым и вторым операндами и устанавливает флаги ZF и CF на основе результата.

##### Примеры
```assembly
PTEST XMM0, XMM1    ; Проверяет биты в XMM0 и XMM1
JZ zero_result      ; Переход, если результат AND равен нулю
```

#### ROUNDPS/ROUNDPD/ROUNDSS/ROUNDSD - Округление

##### Синтаксис
```
ROUNDPS xmm1, xmm2/m128, imm8    ; Округление упакованных чисел с плавающей точкой одиночной точности
ROUNDPD xmm1, xmm2/m128, imm8    ; Округление упакованных чисел с плавающей точкой двойной точности
ROUNDSS xmm1, xmm2/m32, imm8     ; Округление скалярного числа с плавающей точкой одиночной точности
ROUNDSD xmm1, xmm2/m64, imm8     ; Округление скалярного числа с плавающей точкой двойной точности
```

##### Описание
Округляет числа с плавающей точкой согласно указанному режиму округления.

##### Примеры
```assembly
ROUNDPS XMM0, XMM1, 0    ; Округляет числа в XMM1 до ближайшего целого и сохраняет в XMM0
```

### Некоторые важные инструкции SSE4.2

#### PCMPGTQ - Сравнение четверных слов на больше

##### Синтаксис
```
PCMPGTQ xmm1, xmm2/m128    ; Сравнение 2 четверных слов на больше
```

##### Описание
Сравнивает упакованные 64-битные целые числа на больше.

##### Примеры
```assembly
PCMPGTQ XMM0, XMM1    ; Сравнивает 2 четверных слова в XMM0 и XMM1
```

#### PCMPESTRI/PCMPESTRM/PCMPISTRI/PCMPISTRM - Сравнение строк

##### Синтаксис
```
PCMPESTRI xmm1, xmm2/m128, imm8    ; Явное сравнение строк с возвратом индекса
PCMPESTRM xmm1, xmm2/m128, imm8    ; Явное сравнение строк с возвратом маски
PCMPISTRI xmm1, xmm2/m128, imm8    ; Неявное сравнение строк с возвратом индекса
PCMPISTRM xmm1, xmm2/m128, imm8    ; Неявное сравнение строк с возвратом маски
```

##### Описание
Выполняет сложное сравнение строк с различными режимами.

##### Примеры
```assembly
PCMPESTRI XMM0, XMM1, 0x0C    ; Сравнивает строки в XMM0 и XMM1, ищет равные байты
```

#### CRC32 - Вычисление CRC32

##### Синтаксис
```
CRC32 r32/64, r/m8/16/32/64    ; Вычисление CRC32
```

##### Описание
Вычисляет CRC32 для данных.

##### Примеры
```assembly
CRC32 EAX, BL    ; Вычисляет CRC32 для байта в BL, результат в EAX
CRC32 RAX, RBX   ; Вычисляет CRC32 для 64-битного значения в RBX, результат в RAX
```

## AVX/AVX2 инструкции

AVX и AVX2 расширяют SSE инструкции, добавляя поддержку 256-битных регистров YMM0-YMM15 и трехоперандный формат (не перезаписывающий исходные операнды).

### Основные AVX/AVX2 инструкции

#### VMOVDQA/VMOVDQU - Перемещение выровненных/невыровненных 256 бит

##### Синтаксис
```
VMOVDQA ymm1, ymm2/m256    ; Перемещение выровненных 256 бит
VMOVDQA ymm1/m256, ymm2    ; Перемещение выровненных 256 бит
VMOVDQU ymm1, ymm2/m256    ; Перемещение невыровненных 256 бит
VMOVDQU ymm1/m256, ymm2    ; Перемещение невыровненных 256 бит
```

##### Описание
Перемещает 256 бит данных между регистрами YMM или между регистром YMM и памятью.

##### Примеры
```assembly
VMOVDQA YMM0, [RBX]    ; Загружает выровненные 256 бит из памяти в YMM0
VMOVDQU YMM1, [RCX]    ; Загружает невыровненные 256 бит из памяти в YMM1
```

#### VPADDB/VPADDW/VPADDD/VPADDQ - Сложение упакованных целых

##### Синтаксис
```
VPADDB ymm1, ymm2, ymm3/m256    ; Сложение 32 байт
VPADDW ymm1, ymm2, ymm3/m256    ; Сложение 16 слов
VPADDD ymm1, ymm2, ymm3/m256    ; Сложение 8 двойных слов
VPADDQ ymm1, ymm2, ymm3/m256    ; Сложение 4 четверных слов
```

##### Описание
Складывает упакованные целые числа.

##### Примеры
```assembly
VPADDB YMM0, YMM1, YMM2    ; YMM0 = YMM1 + YMM2 (32 байта)
VPADDW YMM3, YMM4, [RCX]   ; YMM3 = YMM4 + [RCX] (16 слов)
```

#### VPAND/VPOR/VPXOR - Логические операции

##### Синтаксис
```
VPAND ymm1, ymm2, ymm3/m256    ; Побитовое И
VPOR ymm1, ymm2, ymm3/m256     ; Побитовое ИЛИ
VPXOR ymm1, ymm2, ymm3/m256    ; Побитовое исключающее ИЛИ
```

##### Описание
Выполняет побитовые логические операции над 256-битными операндами.

##### Примеры
```assembly
VPAND YMM0, YMM1, YMM2    ; YMM0 = YMM1 & YMM2
VPOR YMM3, YMM4, [RCX]    ; YMM3 = YMM4 | [RCX]
VPXOR YMM5, YMM6, YMM7    ; YMM5 = YMM6 ^ YMM7
```

#### VPSLLW/VPSLLD/VPSLLQ - Логический сдвиг влево

##### Синтаксис
```
VPSLLW ymm1, ymm2, xmm3/m128/imm8    ; Сдвиг 16 слов влево
VPSLLD ymm1, ymm2, xmm3/m128/imm8    ; Сдвиг 8 двойных слов влево
VPSLLQ ymm1, ymm2, xmm3/m128/imm8    ; Сдвиг 4 четверных слов влево
```

##### Описание
Сдвигает упакованные целые числа влево.

##### Примеры
```assembly
VPSLLW YMM0, YMM1, 4       ; YMM0 = YMM1 << 4 (16 слов)
VPSLLD YMM2, YMM3, XMM4    ; YMM2 = YMM3 << XMM4 (8 двойных слов)
```

#### VPSRLW/VPSRLD/VPSRLQ - Логический сдвиг вправо

##### Синтаксис
```
VPSRLW ymm1, ymm2, xmm3/m128/imm8    ; Сдвиг 16 слов вправо
VPSRLD ymm1, ymm2, xmm3/m128/imm8    ; Сдвиг 8 двойных слов вправо
VPSRLQ ymm1, ymm2, xmm3/m128/imm8    ; Сдвиг 4 четверных слов вправо
```

##### Описание
Сдвигает упакованные целые числа вправо.

##### Примеры
```assembly
VPSRLW YMM0, YMM1, 4       ; YMM0 = YMM1 >> 4 (16 слов)
VPSRLD YMM2, YMM3, XMM4    ; YMM2 = YMM3 >> XMM4 (8 двойных слов)
```

#### VPCMPEQB/VPCMPEQW/VPCMPEQD/VPCMPEQQ - Сравнение на равенство

##### Синтаксис
```
VPCMPEQB ymm1, ymm2, ymm3/m256    ; Сравнение 32 байт на равенство
VPCMPEQW ymm1, ymm2, ymm3/m256    ; Сравнение 16 слов на равенство
VPCMPEQD ymm1, ymm2, ymm3/m256    ; Сравнение 8 двойных слов на равенство
VPCMPEQQ ymm1, ymm2, ymm3/m256    ; Сравнение 4 четверных слов на равенство
```

##### Описание
Сравнивает упакованные целые числа на равенство.

##### Примеры
```assembly
VPCMPEQB YMM0, YMM1, YMM2    ; Сравнивает 32 байта в YMM1 и YMM2, результат в YMM0
```

### Новые инструкции AVX2

#### VPBROADCASTB/VPBROADCASTW/VPBROADCASTD/VPBROADCASTQ - Широковещательная загрузка

##### Синтаксис
```
VPBROADCASTB ymm1, xmm2/m8       ; Широковещательная загрузка байта
VPBROADCASTW ymm1, xmm2/m16      ; Широковещательная загрузка слова
VPBROADCASTD ymm1, xmm2/m32      ; Широковещательная загрузка двойного слова
VPBROADCASTQ ymm1, xmm2/m64      ; Широковещательная загрузка четверного слова
```

##### Описание
Загружает один элемент и копирует его во все позиции результата.

##### Примеры
```assembly
VPBROADCASTB YMM0, AL       ; Копирует байт из AL во все 32 позиции YMM0
VPBROADCASTD YMM1, [RCX]    ; Копирует двойное слово из памяти во все 8 позиций YMM1
```

#### VPERMD/VPERMQ - Перестановка двойных/четверных слов

##### Синтаксис
```
VPERMD ymm1, ymm2, ymm3/m256    ; Перестановка двойных слов
VPERMQ ymm1, ymm2/m256, imm8    ; Перестановка четверных слов
```

##### Описание
Переставляет элементы согласно индексам или непосредственному значению.

##### Примеры
```assembly
VPERMD YMM0, YMM1, YMM2    ; Переставляет двойные слова из YMM2 согласно индексам в YMM1
VPERMQ YMM3, YMM4, 0x1B    ; Переставляет четверные слова в YMM4 согласно непосредственному значению
```

#### VPGATHERDD/VPGATHERDQ/VPGATHERQD/VPGATHERQQ - Сбор с индексацией

##### Синтаксис
```
VPGATHERDD ymm1, [base+ymm2*scale], ymm3    ; Сбор двойных слов с индексацией
VPGATHERDQ ymm1, [base+xmm2*scale], ymm3    ; Сбор четверных слов с индексацией
VPGATHERQD xmm1, [base+ymm2*scale], xmm3    ; Сбор двойных слов с индексацией
VPGATHERQQ ymm1, [base+ymm2*scale], ymm3    ; Сбор четверных слов с индексацией
```

##### Описание
Загружает элементы из памяти с индексацией.

##### Примеры
```assembly
VPGATHERDD YMM0, [RAX+YMM1*4], YMM2    ; Загружает двойные слова из памяти с индексацией
```

## AVX-512 инструкции

AVX-512 расширяет AVX/AVX2, добавляя поддержку 512-битных регистров ZMM0-ZMM31 и 8 регистров маски K0-K7.

### Основные AVX-512 инструкции

#### VMOVDQA32/VMOVDQA64/VMOVDQU32/VMOVDQU64 - Перемещение 512 бит

##### Синтаксис
```
VMOVDQA32 zmm1 {k1}{z}, zmm2/m512    ; Перемещение выровненных 512 бит (32-битные элементы)
VMOVDQA64 zmm1 {k1}{z}, zmm2/m512    ; Перемещение выровненных 512 бит (64-битные элементы)
VMOVDQU32 zmm1 {k1}{z}, zmm2/m512    ; Перемещение невыровненных 512 бит (32-битные элементы)
VMOVDQU64 zmm1 {k1}{z}, zmm2/m512    ; Перемещение невыровненных 512 бит (64-битные элементы)
```

##### Описание
Перемещает 512 бит данных между регистрами ZMM или между регистром ZMM и памятью, с опциональной маской.

##### Примеры
```assembly
VMOVDQA32 ZMM0, [RBX]           ; Загружает выровненные 512 бит из памяти в ZMM0
VMOVDQU64 ZMM1 {K1}, ZMM2       ; Копирует ZMM2 в ZMM1 с применением маски K1
VMOVDQA32 ZMM3 {K2}{z}, [RCX]   ; Загружает данные из памяти в ZMM3 с маской K2 и обнулением
```

#### VPADDB/VPADDW/VPADDD/VPADDQ - Сложение упакованных целых

##### Синтаксис
```
VPADDB zmm1 {k1}{z}, zmm2, zmm3/m512    ; Сложение 64 байт
VPADDW zmm1 {k1}{z}, zmm2, zmm3/m512    ; Сложение 32 слов
VPADDD zmm1 {k1}{z}, zmm2, zmm3/m512    ; Сложение 16 двойных слов
VPADDQ zmm1 {k1}{z}, zmm2, zmm3/m512    ; Сложение 8 четверных слов
```

##### Описание
Складывает упакованные целые числа с опциональной маской.

##### Примеры
```assembly
VPADDB ZMM0, ZMM1, ZMM2          ; ZMM0 = ZMM1 + ZMM2 (64 байта)
VPADDW ZMM3 {K1}, ZMM4, [RCX]    ; ZMM3 = ZMM4 + [RCX] (32 слова) с маской K1
```

#### VPANDD/VPANDQ/VPORD/VPORQ/VPXORD/VPXORQ - Логические операции

##### Синтаксис
```
VPANDD zmm1 {k1}{z}, zmm2, zmm3/m512    ; Побитовое И (32-битные элементы)
VPANDQ zmm1 {k1}{z}, zmm2, zmm3/m512    ; Побитовое И (64-битные элементы)
VPORD zmm1 {k1}{z}, zmm2, zmm3/m512     ; Побитовое ИЛИ (32-битные элементы)
VPORQ zmm1 {k1}{z}, zmm2, zmm3/m512     ; Побитовое ИЛИ (64-битные элементы)
VPXORD zmm1 {k1}{z}, zmm2, zmm3/m512    ; Побитовое исключающее ИЛИ (32-битные элементы)
VPXORQ zmm1 {k1}{z}, zmm2, zmm3/m512    ; Побитовое исключающее ИЛИ (64-битные элементы)
```

##### Описание
Выполняет побитовые логические операции над 512-битными операндами с опциональной маской.

##### Примеры
```assembly
VPANDD ZMM0, ZMM1, ZMM2          ; ZMM0 = ZMM1 & ZMM2
VPORD ZMM3 {K1}, ZMM4, [RCX]     ; ZMM3 = ZMM4 | [RCX] с маской K1
```

#### VPSLLW/VPSLLD/VPSLLQ - Логический сдвиг влево

##### Синтаксис
```
VPSLLW zmm1 {k1}{z}, zmm2, xmm3/m128/imm8    ; Сдвиг 32 слов влево
VPSLLD zmm1 {k1}{z}, zmm2, xmm3/m128/imm8    ; Сдвиг 16 двойных слов влево
VPSLLQ zmm1 {k1}{z}, zmm2, xmm3/m128/imm8    ; Сдвиг 8 четверных слов влево
```

##### Описание
Сдвигает упакованные целые числа влево с опциональной маской.

##### Примеры
```assembly
VPSLLW ZMM0, ZMM1, 4              ; ZMM0 = ZMM1 << 4 (32 слова)
VPSLLD ZMM2 {K1}, ZMM3, XMM4      ; ZMM2 = ZMM3 << XMM4 (16 двойных слов) с маской K1
```

#### VPSRLW/VPSRLD/VPSRLQ - Логический сдвиг вправо

##### Синтаксис
```
VPSRLW zmm1 {k1}{z}, zmm2, xmm3/m128/imm8    ; Сдвиг 32 слов вправо
VPSRLD zmm1 {k1}{z}, zmm2, xmm3/m128/imm8    ; Сдвиг 16 двойных слов вправо
VPSRLQ zmm1 {k1}{z}, zmm2, xmm3/m128/imm8    ; Сдвиг 8 четверных слов вправо
```

##### Описание
Сдвигает упакованные целые числа вправо с опциональной маской.

##### Примеры
```assembly
VPSRLW ZMM0, ZMM1, 4              ; ZMM0 = ZMM1 >> 4 (32 слова)
VPSRLD ZMM2 {K1}, ZMM3, XMM4      ; ZMM2 = ZMM3 >> XMM4 (16 двойных слов) с маской K1
```

### Инструкции для работы с масками

#### KMOVW/KMOVB/KMOVD/KMOVQ - Перемещение масок

##### Синтаксис
```
KMOVW k1, k2/r32/m16    ; Перемещение 16-битной маски
KMOVB k1, k2/r32/m8     ; Перемещение 8-битной маски
KMOVD k1, k2/r32/m32    ; Перемещение 32-битной маски
KMOVQ k1, k2/r64/m64    ; Перемещение 64-битной маски
```

##### Описание
Перемещает данные маски между регистрами маски или между регистром маски и регистром общего назначения или памятью.

##### Примеры
```assembly
KMOVW K1, EAX    ; Загружает 16-битную маску из EAX в K1
KMOVB K2, K3     ; Копирует 8-битную маску из K3 в K2
```

#### KANDW/KANDNW/KORW/KXORW - Логические операции с масками

##### Синтаксис
```
KANDW k1, k2, k3     ; Побитовое И масок
KANDNW k1, k2, k3    ; Побитовое И-НЕ масок
KORW k1, k2, k3      ; Побитовое ИЛИ масок
KXORW k1, k2, k3     ; Побитовое исключающее ИЛИ масок
```

##### Описание
Выполняет побитовые логические операции над масками.

##### Примеры
```assembly
KANDW K1, K2, K3     ; K1 = K2 & K3
KORW K4, K5, K6      ; K4 = K5 | K6
```

#### KNOTW/KNOTB/KNOTD/KNOTQ - Инвертирование маски

##### Синтаксис
```
KNOTW k1, k2    ; Инвертирование 16-битной маски
KNOTB k1, k2    ; Инвертирование 8-битной маски
KNOTD k1, k2    ; Инвертирование 32-битной маски
KNOTQ k1, k2    ; Инвертирование 64-битной маски
```

##### Описание
Инвертирует все биты маски.

##### Примеры
```assembly
KNOTW K1, K2    ; K1 = ~K2 (16-битная маска)
```

## Примечания

1. Выбор набора SIMD инструкций:
   - MMX устарел и не рекомендуется для нового кода
   - SSE/SSE2 поддерживаются всеми 64-битными процессорами
   - AVX/AVX2 обеспечивают лучшую производительность на современных процессорах
   - AVX-512 доступен только на новейших процессорах

2. Выравнивание данных:
   - Для оптимальной производительности данные должны быть выровнены по границе 16 байт для SSE, 32 байт для AVX и 64 байт для AVX-512
   - Инструкции с префиксом "A" (MOVDQA, VMOVDQA) требуют выровненных данных
   - Инструкции с префиксом "U" (MOVDQU, VMOVDQU) работают с невыровненными данными, но медленнее

3. Переключение между наборами инструкций:
   - Переключение между SSE и AVX может вызывать задержки (AVX-SSE transition penalty)
   - Рекомендуется использовать инструкции из одного набора в пределах горячих участков кода

4. Производительность:
   - SIMD инструкции могут значительно ускорить обработку данных
   - Эффективность зависит от возможности распараллеливания алгоритма
   - Некоторые инструкции имеют высокую латентность или низкую пропускную способность

5. Совместимость:
   - Перед использованием расширенных наборов инструкций (AVX, AVX2, AVX-512) следует проверить их поддержку с помощью CPUID
   - Для максимальной совместимости можно реализовать несколько версий кода для разных наборов инструкций
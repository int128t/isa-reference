# Полный справочник групп опкодов x86-64

## Структура пространства опкодов

x86-64 использует многоуровневую систему опкодов:

```
Однобайтные опкоды:    00h - FFh (основная таблица)
Двухбайтные опкоды:    0F xx (расширенная таблица)
Трехбайтные опкоды:    0F 38 xx, 0F 3A xx (SSE/AVX)
VEX опкоды:           VEX + карта опкодов
EVEX опкоды:          EVEX + карта опкодов
```

---

## 1. Однобайтные опкоды (00h-FFh)

### Группа 00h-3Fh: Арифметические операции

| Диапазон | Инструкции | Описание |
|----------|------------|----------|
| **00h-05h** | ADD | Сложение |
| **08h-0Dh** | OR | Логическое ИЛИ |
| **10h-15h** | ADC | Сложение с переносом |
| **18h-1Dh** | SBB | Вычитание с заемом |
| **20h-25h** | AND | Логическое И |
| **28h-2Dh** | SUB | Вычитание |
| **30h-35h** | XOR | Исключающее ИЛИ |
| **38h-3Dh** | CMP | Сравнение |

```assembly
; Примеры
add eax, ebx        ; 01 D8
or al, 42h          ; 0C 42
adc rax, [rbx]      ; 48 13 03
sbb ecx, edx        ; 19 D1
and rsi, rdi        ; 48 21 FE
sub rsp, 16         ; 48 83 EC 10
xor eax, eax        ; 31 C0
cmp rax, rbx        ; 48 39 D8
```

### Группа 40h-5Fh: Операции с регистрами (в 32-битном режиме)

| Диапазон | Инструкции | Описание |
|----------|------------|----------|
| **40h-47h** | INC reg | Инкремент регистра |
| **48h-4Fh** | DEC reg | Декремент регистра |
| **50h-57h** | PUSH reg | Поместить в стек |
| **58h-5Fh** | POP reg | Извлечь из стека |

**Важно:** В 64-битном режиме 40h-4Fh используются для REX префиксов!

```assembly
; В 32-битном режиме
inc eax             ; 40
dec ebx             ; 4B
push ecx            ; 51
pop edx             ; 5A

; В 64-битном режиме
push rax            ; 50
pop rbx             ; 5B
inc eax             ; FF C0 (через группу FF)
```

### Группа 60h-7Fh: Стек и условные переходы

| Диапазон | Инструкции | Описание |
|----------|------------|----------|
| **60h** | PUSHA | Поместить все регистры (только 16/32-бит) |
| **61h** | POPA | Извлечь все регистры (только 16/32-бит) |
| **68h** | PUSH imm32 | Поместить константу |
| **6Ah** | PUSH imm8 | Поместить байт (с расширением знака) |
| **70h-7Fh** | Jcc | Условные переходы (короткие) |

```assembly
; Стековые операции
push 12345678h      ; 68 78 56 34 12
push 42h            ; 6A 42

; Условные переходы (8-битное смещение)
jz label            ; 74 xx
jne label           ; 75 xx
jg label            ; 7F xx
```

### Группа 80h-BFh: Непосредственные операнды и перемещения

| Диапазон | Инструкции | Описание |
|----------|------------|----------|
| **80h-83h** | Группа 1 | ADD/OR/ADC/SBB/AND/SUB/XOR/CMP с imm |
| **88h-8Bh** | MOV | Перемещение данных |
| **8Dh** | LEA | Загрузка эффективного адреса |
| **90h-97h** | XCHG | Обмен с EAX/RAX |
| **98h-9Fh** | Расширения | CBW, CWD, SAHF, LAHF и др. |
| **A0h-A3h** | MOV | MOV между аккумулятором и памятью |
| **B0h-BFh** | MOV | MOV константы в регистры |

```assembly
; Группа 1 (арифметика с константами)
add eax, 100        ; 83 C0 64
cmp byte ptr [rax], 5 ; 80 38 05

; Перемещения
mov eax, ebx        ; 89 D8
mov rax, [rbx+8]    ; 48 8B 43 08
lea rax, [rbx+rcx*2+10] ; 48 8D 44 4B 0A

; Обмен
xchg eax, ecx       ; 91
xchg rax, [rbx]     ; 48 87 03

; MOV констант
mov al, 42h         ; B0 42
mov eax, 12345678h  ; B8 78 56 34 12
mov rax, 123456789ABCDEFh ; 48 B8 EF CD AB 89 67 45 23 01
```

### Группа C0h-FFh: Управление и разное

| Диапазон | Инструкции | Описание |
|----------|------------|----------|
| **C0h-C1h** | Группа 2 | Сдвиги и повороты с imm8 |
| **C2h-C3h** | RET | Возврат из функции |
| **C6h-C7h** | MOV | MOV константы в память |
| **C8h** | ENTER | Создание стекового кадра |
| **C9h** | LEAVE | Разрушение стекового кадра |
| **CDh** | INT | Программное прерывание |
| **D0h-D3h** | Группа 2 | Сдвиги на 1 или CL |
| **E0h-E3h** | LOOP/JCXZ | Циклы и условные переходы |
| **E8h** | CALL | Вызов функции (относительный) |
| **E9h** | JMP | Безусловный переход (относительный) |
| **F6h-F7h** | Группа 3 | TEST, NOT, NEG, MUL, IMUL, DIV, IDIV |
| **FEh-FFh** | Группа 4/5 | INC, DEC, CALL, JMP |

```assembly
; Возврат
ret                 ; C3
ret 16              ; C2 10 00

; Вызовы и переходы
call func           ; E8 xx xx xx xx
jmp label           ; E9 xx xx xx xx

; Умножение и деление
mul ebx             ; F7 E3
div ecx             ; F7 F1

; Инкремент/декремент (64-битный режим)
inc dword ptr [rax] ; FF 00
dec qword ptr [rbx] ; 48 FF 0B
```

---

## 2. Двухбайтные опкоды (0F xx)

### Группа 0F 00h-0F 1Fh: Системные и групповые инструкции

| Опкод | Инструкция | Описание |
|-------|------------|----------|
| **0F 00** | Группа 6 | SLDT, STR, LLDT, LTR, VERR, VERW |
| **0F 01** | Группа 7 | SGDT, SIDT, LGDT, LIDT, SMSW, LMSW, INVLPG, SWAPGS |
| **0F 02** | LAR | Load Access Rights |
| **0F 03** | LSL | Load Segment Limit |
| **0F 05** | SYSCALL | Системный вызов (только 64-бит) |
| **0F 06** | CLTS | Clear Task Switched Flag |
| **0F 07** | SYSRET | Возврат из системного вызова |
| **0F 08** | INVD | Invalidate Data Cache |
| **0F 09** | WBINVD | Write Back and Invalidate Cache |
| **0F 0B** | UD2 | Undefined Instruction |
| **0F 18** | Группа 16 | Prefetch |
| **0F 1F** | NOP | Многобайтный NOP |

### Группа 0F 20h-0F 3Fh: Управляющие регистры и условные перемещения

| Диапазон | Инструкции | Описание |
|----------|------------|----------|
| **0F 20-23** | MOV | Перемещение управляющих/отладочных регистров |
| **0F 30-37** | Системные | WRMSR, RDTSC, RDMSR, RDPMC, SYSENTER, SYSEXIT |
| **0F 40-4F** | CMOVcc | Условные перемещения |

```assembly
; Условные перемещения
cmovz eax, ebx      ; 0F 44 C3
cmovne rax, [rbx]   ; 48 0F 45 03

; Системные
rdtsc               ; 0F 31
cpuid               ; 0F A2
```

### Группа 0F 80h-0F 9Fh: Условные переходы (дальние)

| Диапазон | Инструкции | Описание |
|----------|------------|----------|
| **0F 80-8F** | Jcc | Условные переходы (32-битное смещение) |
| **0F 90-9F** | SETcc | Установка байта по условию |

```assembly
; Дальние условные переходы
jz far_label        ; 0F 84 xx xx xx xx
jne far_label       ; 0F 85 xx xx xx xx

; Установка по условию
setz al             ; 0F 94 C0
setne bl            ; 0F 95 C3
```

### Группа 0F A0h-0F FFh: Строковые, битовые и разные операции

| Диапазон | Инструкции | Описание |
|----------|------------|----------|
| **0F A3-AB** | BT, BTS, BTR, BTC | Битовые операции |
| **0F AF** | IMUL | Знаковое умножение |
| **0F B0-B1** | CMPXCHG | Compare and Exchange |
| **0F B2-B5** | LSS, LFS, LGS | Загрузка сегментных регистров |
| **0F B6-B7** | MOVZX | Перемещение с расширением нулями |
| **0F BE-BF** | MOVSX | Перемещение с расширением знаком |
| **0F C0-C1** | XADD | Exchange and Add |
| **0F C8-CF** | BSWAP | Обращение порядка байт |

```assembly
; Битовые операции
bt eax, 5           ; 0F A3 E8
bts dword ptr [rbx], 7 ; 0F AB 3B

; Умножение
imul eax, ebx, 10   ; 6B C3 0A

; Расширения
movzx eax, bl       ; 0F B6 C3
movsx rax, eax      ; 48 63 C0

; Атомарные операции
cmpxchg [rax], ebx  ; 0F B1 18
xadd [rax], ebx     ; 0F C1 18
```

---

## 3. Трехбайтные опкоды

### Карта 0F 38h: SSE расширения

| Диапазон | Инструкции | Описание |
|----------|------------|----------|
| **0F 38 00-0B** | PSHUFB, PHADDW, PHADDD и др. | SSSE3 инструкции |
| **0F 38 10-17** | PBLENDVB, BLENDVPS и др. | SSE4.1 инструкции |
| **0F 38 20-25** | PMOVSXBW, PMOVSXBD и др. | Знаковые расширения |
| **0F 38 28-2B** | PMULDQ, PCMPEQQ и др. | 64-битные операции |
| **0F 38 30-3F** | PMOVZXBW, PMOVZXBD и др. | Расширения нулями |
| **0F 38 40-41** | PMULLD, PHMINPOSUW | SSE4.1 операции |
| **0F 38 F0-F1** | MOVBE, CRC32 | Обмен байт, CRC32 |

### Карта 0F 3Ah: SSE с непосредственными операндами

| Диапазон | Инструкции | Описание |
|----------|------------|----------|
| **0F 3A 08-0F** | ROUNDPS, ROUNDPD и др. | Округления |
| **0F 3A 14-17** | PEXTRB, PEXTRD и др. | Извлечение элементов |
| **0F 3A 20-22** | PINSRB, INSERTPS, PINSRD | Вставка элементов |
| **0F 3A 60-63** | PCMPESTRM, PCMPESTRI и др. | Строковые сравнения |

---

## 4. SSE/MMX опкоды (0F xx)

### MMX инструкции (0F 6x-7x, 0F Dx-Fx)

| Диапазон | Инструкции | Описание |
|----------|------------|----------|
| **0F 60-6F** | PUNPCKLBW, PUNPCKLWD и др. | Упаковка/распаковка |
| **0F 70** | PSHUFW | Перестановка |
| **0F 71-73** | Группы сдвигов | PSRLW, PSRAW, PSLLW и др. |
| **0F 74-76** | PCMPEQB, PCMPEQW, PCMPEQD | Сравнения |
| **0F 7E-7F** | MOVD, MOVQ | Перемещения |
| **0F D1-DF** | PSRLW, PSRLD и др. | Логические сдвиги |
| **0F E1-EF** | PSRAW, PSRAD и др. | Арифметические сдвиги |
| **0F F1-FF** | PSLLW, PSLLD и др. | Левые сдвиги |

### SSE инструкции

| Диапазон | Инструкции | Описание |
|----------|------------|----------|
| **0F 10-17** | MOVUPS, MOVSS и др. | Перемещения (с префиксами) |
| **0F 28-2F** | MOVAPS, MOVAPD и др. | Выравненные перемещения |
| **0F 50-5F** | MOVMSKPS, SQRTPS и др. | Разные операции |
| **0F C2** | CMPPS/CMPSS | Сравнения с предикатом |

---

## 5. VEX опкоды

### VEX карты опкодов

| Карта | Префикс | Описание |
|-------|---------|----------|
| **01** | 0F | Основные AVX инструкции |
| **02** | 0F 38 | AVX расширения |
| **03** | 0F 3A | AVX с непосредственными операндами |

### Примеры VEX инструкций

```assembly
; AVX арифметика
vaddps xmm0, xmm1, xmm2    ; C5 F0 58 C2
vaddps ymm0, ymm1, ymm2    ; C5 F4 58 C2

; AVX с памятью
vmovaps ymm0, [rax]        ; C5 FC 28 00
vbroadcastss ymm0, [rax]   ; C4 E2 7D 18 00
```

---

## 6. EVEX опкоды (AVX-512)

### EVEX карты

| Карта | Описание |
|-------|----------|
| **01** | Основные AVX-512 |
| **02** | AVX-512 расширения |
| **03** | AVX-512 с непосредственными |

```assembly
; AVX-512 примеры
vaddps zmm0, zmm1, zmm2           ; 62 F1 74 48 58 C2
vaddps zmm0{k1}, zmm1, zmm2       ; 62 F1 74 49 58 C2
vaddps zmm0{k1}{z}, zmm1, zmm2    ; 62 F1 74 C9 58 C2
```

---

## 7. Групповые опкоды

### Группа 1 (80h-83h): Арифметические операции

| /r | Инструкция |
|----|------------|
| /0 | ADD |
| /1 | OR |
| /2 | ADC |
| /3 | SBB |
| /4 | AND |
| /5 | SUB |
| /6 | XOR |
| /7 | CMP |

### Группа 2 (C0h, C1h, D0h-D3h): Сдвиги и повороты

| /r | Инструкция |
|----|------------|
| /0 | ROL |
| /1 | ROR |
| /2 | RCL |
| /3 | RCR |
| /4 | SHL/SAL |
| /5 | SHR |
| /6 | SAL |
| /7 | SAR |

### Группа 3 (F6h, F7h): Унарные операции

| /r | Инструкция |
|----|------------|
| /0 | TEST |
| /1 | TEST |
| /2 | NOT |
| /3 | NEG |
| /4 | MUL |
| /5 | IMUL |
| /6 | DIV |
| /7 | IDIV |

### Группа 4 (FEh): 8-битные операции

| /r | Инструкция |
|----|------------|
| /0 | INC |
| /1 | DEC |

### Группа 5 (FFh): Разные операции

| /r | Инструкция |
|----|------------|
| /0 | INC |
| /1 | DEC |
| /2 | CALL near |
| /3 | CALL far |
| /4 | JMP near |
| /5 | JMP far |
| /6 | PUSH |

---

## 8. Специальные диапазоны

### Неиспользуемые/зарезервированные опкоды

| Диапазон | Статус |
|----------|--------|
| **06h, 0Eh, 16h, 1Eh** | PUSH/POP сегментных регистров (устарело в 64-бит) |
| **27h, 2Fh, 37h, 3Fh** | AAA, AAS, AAD, AAS (недоступно в 64-бит) |
| **60h, 61h** | PUSHA/POPA (недоступно в 64-бит) |
| **9Ah** | CALL far (недоступно в 64-бит) |
| **CEh** | INTO (недоступно в 64-бит) |
| **D4h, D5h** | AAM, AAD (недоступно в 64-бит) |
| **D6h** | SALC (недокументированный) |
| **EAh** | JMP far (недоступно в 64-бит) |

### Escape-опкоды для сопроцессора

| Диапазон | Назначение |
|----------|------------|
| **D8h-DFh** | x87 FPU инструкции |

```assembly
; x87 примеры
fadd st(0), st(1)   ; D8 C1
fld qword ptr [rax] ; DD 00
fstp st(1)          ; DD D9
```

---

## Заключение

Система опкодов x86-64 включает:

- **256 однобайтных опкодов** (00h-FFh)
- **256 двухбайтных опкодов** (0F 00h - 0F FFh)  
- **512 трехбайтных опкодов** (0F 38h xx, 0F 3Ah xx)
- **Тысячи VEX/EVEX опкодов** для векторных операций
- **Групповые опкоды** с подкомандами в поле /r

Для изучения рекомендую начинать с основных однобайтных опкодов, затем переходить к двухбайтным системным инструкциям, и только потом изучать векторные расширения.